description: Home server Telegram agent using PydanticAI + MCP for natural language
  control of home services
phases:
- focus: A working bot that can search and request media via natural language conversation.
  id: 1
  name: MVP — Telegram + Jellyseerr
  steps:
  - files:
    - pyproject.toml
    - src/home_agent/__init__.py
    - src/home_agent/config.py
    - .env.example
    goal: Runnable Python project with validated config loading.
    id: '1.1'
    name: Project Scaffolding
    notes: ''
    scope: "- src/ package layout\n- pydantic-settings AppConfig model with fields\
      \ for TELEGRAM_BOT_TOKEN,\n  OPENROUTER_API_KEY, JELLYSEERR_URL, JELLYSEERR_API_KEY,\
      \ ALLOWED_TELEGRAM_IDS\n- .env.example with all keys documented\n"
    status: done
    test: '- test_config.py — Config loads from env vars

      - Missing required vars raise ValidationError

      - ALLOWED_TELEGRAM_IDS parses comma-separated list of ints

      '
  - files:
    - src/home_agent/db.py
    goal: Async database with schema migrations for conversations and profiles.
    id: '1.2'
    name: SQLite Database Layer
    notes: ''
    scope: '- aiosqlite connection manager

      - init_db() creates tables (conversations, user_profiles)

      - Helper functions: save_message(), get_history(), save_profile(), get_profile()

      '
    status: done
    test: '- test_db.py — init_db() creates tables

      - save_message() + get_history() round-trips messages per user

      - save_profile() + get_profile() round-trips a profile JSON blob

      - Empty history returns empty list

      '
  - files:
    - src/home_agent/profile.py
    goal: Pydantic models for user profile with serialization to/from SQLite.
    id: '1.3'
    name: User Profile Model
    notes: ''
    scope: '- UserProfile, MediaPreferences, NotificationPrefs Pydantic models

      - ProfileManager class that reads/writes profiles via db.py

      - Default profile creation for new users

      '
    status: done
    test: '- test_profile.py — Default profile has sensible defaults

      - Profile serializes to JSON and deserializes back identically

      - ProfileManager creates default profile for unknown user

      - ProfileManager updates and persists profile fields

      '
  - files:
    - src/home_agent/history.py
    goal: Store full history in SQLite, send only a sliding window to the LLM.
    id: '1.4'
    name: Conversation History & Processor
    notes: ''
    scope: "- HistoryManager class wrapping db.py for message CRUD\n- sliding_window_processor\
      \ compatible with PydanticAI's history_processors\n  — keeps last N message\
      \ pairs\n- User profile injected into system prompt context\n"
    status: pending
    test: '- test_history.py — Full history preserved in DB

      - Sliding window with N=5 returns only last 5 message pairs from a 20-message
      history

      - Tool-call/tool-result pairs are not split across the window boundary

      '
  - files:
    - src/home_agent/bot.py
    goal: Bot connects to Telegram, receives messages, enforces user whitelist.
    id: '1.5'
    name: Telegram Bot Skeleton
    notes: ''
    scope: '- python-telegram-bot Application setup with polling (webhook later)

      - Message handler that receives text

      - User whitelist check against ALLOWED_TELEGRAM_IDS

      - Unauthorized users get a rejection message

      - Typing indicator while processing

      '
    status: done
    test: '- test_bot.py — Whitelisted user''s message is forwarded to handler

      - Non-whitelisted user gets rejection

      - Bot sends typing action before responding

      '
  - files:
    - src/home_agent/agent.py
    goal: Agent configured with OpenRouter, system prompt, dependency injection.
    id: '1.6'
    name: PydanticAI Agent Setup
    notes: ''
    scope: '- PydanticAI Agent with OpenRouter model (free tier)

      - System prompt template that includes user profile context and confirmation
      rules

      - AgentDeps dataclass with profile_manager, history_manager, config

      - Profile update tool registered on the agent

      '
    status: done
    test: '- test_agent.py — Agent instantiates without error

      - System prompt contains user profile data when provided

      - Profile update tool modifies profile via ProfileManager

      '
  - files:
    - deployment/docker-compose.yml
    goal: MCP server exposing Jellyseerr search and request capabilities.
    id: '1.7'
    name: Jellyseerr MCP Server
    notes: 'Community Docker image ghcr.io/aserper/jellyseerr-mcp used. No custom code. Agent connects via FastMCPToolset("http://localhost:5056/mcp") in step 1.8.'
    scope: "- Community MCP server deployed via Docker Compose\n- Agent connects via\
      \ HTTP FastMCPToolset\n- Config from .env (JELLYSEERR_URL, JELLYSEERR_API_KEY,\
      \ MCP_PORT)\n"
    status: done
    test: 'No unit tests — community server has no custom code to test. Integration
      tested end-to-end in step 1.9.'
  - files:
    - src/home_agent/mcp/__init__.py
    - src/home_agent/mcp/registry.py
    - src/home_agent/mcp/servers.py
    - tests/test_mcp_registry.py
    - tests/test_mcp_servers.py
    goal: Central place to configure and expose MCP server connections as PydanticAI toolsets.
    id: '1.8'
    name: MCP Registry & Lifecycle
    notes: 'MCPRegistry holds ServerConfig instances and creates FastMCPToolset(url)
      on demand. No start/stop needed — Docker manages server lifecycle. get_jellyseerr_config()
      factory reads MCP_PORT from AppConfig. Import-linter contract: mcp does not
      import agent, bot, or main.'
    scope: '- MCPRegistry class with register(), get_toolsets(), get_tool_names()

      - ServerConfig dataclass (name, url, enabled)

      - get_jellyseerr_config() factory in servers.py

      - FastMCPToolset instances created lazily (safe without live connection)

      - Import-linter Layer 2 contract enforced

      '
    status: done
    test: '- test_mcp_registry.py — 5 tests: registry stores configs, get_toolsets
      returns FastMCPToolset per enabled server, disabled servers excluded, get_tool_names
      returns names

      - test_mcp_servers.py — 3 tests: get_jellyseerr_config returns correct ServerConfig

      '
  - files:
    - src/home_agent/main.py
    - src/home_agent/agent.py
    - tests/test_main.py
    - tests/test_integration.py
    - .env.example
    goal: 'End-to-end flow: Telegram message → Agent → MCP tools → Telegram reply.'
    id: '1.9'
    name: Wire It Together
    notes: 'main.py is the composition root. get_agent_toolsets() added to agent.py
      as a hook for toolset retrieval. MCPRegistry is created and populated in main.py
      but toolsets are NOT yet passed to the agent — this requires a DI refactor
      (see step 1.9b). Import-linter Layer 4 contract: no module imports main.'
    scope: '- main() composition root: config → logging → DB → managers → MCP registry
      → bot polling

      - setup_logging() helper for root logger configuration

      - get_agent_toolsets() factory in agent.py returning toolsets from registry

      - Graceful KeyboardInterrupt shutdown

      - Import-linter Layer 4 contract enforced

      - .env.example updated with MCP_PORT and LOG_LEVEL

      '
    status: done
    test: '- test_main.py — setup_logging sets root logger level, main() wires all
      components with correct arguments, KeyboardInterrupt handled gracefully

      - test_integration.py — full message pipeline: authorized user message persisted
      to DB + agent reply sent; unauthorized user rejected and not persisted; agent
      receives correct deps

      - test_agent.py — get_agent_toolsets() delegates to registry.get_toolsets()

      '
  - files:
    - src/home_agent/agent.py
    - src/home_agent/bot.py
    - src/home_agent/main.py
    - tests/test_agent.py
    - tests/test_bot.py
    - tests/test_main.py
    goal: Wire the MCPRegistry toolsets into the PydanticAI agent so MCP tools are
      available at runtime.
    id: '1.9b'
    name: Wire MCP Toolsets into Agent
    notes: ''
    scope: "The agent is currently a module-level singleton defined in agent.py without\
      \ toolsets. PydanticAI requires toolsets to be passed to Agent() at construction\
      \ time — they cannot be added to an existing instance after the fact.\n\nThe\
      \ refactor needed:\n1. Replace the module-level `agent` singleton in agent.py\
      \ with a factory function\n   `create_agent(toolsets)` that constructs and returns\
      \ an Agent with the\n   given toolsets.\n2. In main.py: call `create_agent(registry.get_toolsets())`\
      \ after the registry is\n   populated, producing the fully-wired agent instance.\n\
      3. In bot.py: replace the `from home_agent.agent import agent` import with an\n\
      \   `agent` parameter on `make_message_handler()`, `create_application()`, and\n\
      \   `run_bot()` — the agent is injected from main.py rather than imported as\
      \ a\n   global singleton.\n4. Update all tests that reference the global `agent`\
      \ to use the factory or\n   inject a TestModel-overridden agent instance.\n\n\
      Key constraint: import-linter contracts must stay green. bot.py may not import\n\
      main.py. The agent flows main → bot, not bot → agent (singleton).\n"
    status: done
    test: '- test_agent.py — create_agent() returns Agent with correct toolsets registered

      - test_bot.py — make_message_handler() accepts agent parameter; handler calls
      injected agent

      - test_main.py — main() calls create_agent() with toolsets from registry and
      passes result to run_bot()

      - test_integration.py — end-to-end flow uses agent with mocked MCP toolset

      '
  - files:
    - Dockerfile
    - docker-compose.yml
    goal: Single-command deployment on home server.
    id: '1.10'
    name: Docker Deployment
    notes: ''
    scope: '- Multi-stage Dockerfile (build + runtime)

      - docker-compose.yml with env_file, volume for SQLite persistence, restart policy

      - Health check endpoint (optional)

      '
    status: done
    test: '- docker build succeeds

      - docker-compose up starts the bot without errors

      - Container logs show successful Telegram connection

      '
- focus: User experience, preferences, and conversational quality — the agent should
    feel like it knows you.
  id: 2
  name: User Experience & Profile
  steps:
  - files:
    - src/home_agent/profile.py
    - tests/test_profile.py
    goal: Profile model reflects what's actually used — quality per media type, reply
      language, confirmation mode.
    id: '2.1'
    name: Simplify UserProfile
    notes: 'See docs/LLM/plans/user-experience/ux-profile-and-confirmation.md for
      full design rationale and sparring decisions.'
    scope: "- Remove dead fields: preferred_genres, avoid_genres, preferred_language\
      \ (media), NotificationPrefs, stats\n- Split quality: movie_quality and series_quality\
      \ (Literal[\"4k\", \"1080p\"] | None)\n- Add reply_language: str = \"english\"\
      \n- Add confirmation_mode: Literal[\"always\", \"never\"] = \"always\"\n- Migration:\
      \ Pydantic ignores unknown fields on deserialize, removed fields disappear on\
      \ next save\n"
    status: done
    test: '- test_profile.py — Default profile has movie_quality=None, series_quality=None,
      reply_language="english", confirmation_mode="always"

      - Profile with removed fields deserializes without error (migration)

      - Profile round-trips through JSON with new fields intact

      '
  - files:
    - src/home_agent/bot.py
    - src/home_agent/profile.py
    - tests/test_bot.py
    - tests/test_profile.py
    goal: New users get their reply language auto-detected from Telegram locale.
    id: '2.2'
    name: Auto-detect Reply Language
    notes: 'Telegram language_code is app language, not chat language — acceptable
      because set_reply_language tool is the escape hatch.'
    scope: "- bot.py passes update.effective_user.language_code to ProfileManager on\
      \ first profile creation\n- Minimal mapping: nl → Dutch, en → English, fr →\
      \ French, de → German, fallback → English\n- ProfileManager.get_or_create_profile()\
      \ accepts optional language_code parameter\n"
    status: done
    test: '- test_bot.py — New user with language_code="nl" gets profile with reply_language="Dutch"

      - New user with language_code=None gets reply_language="English"

      - Existing user profile is not overwritten on subsequent messages

      '
  - files:
    - src/home_agent/config.py
    - .env.example
    - tests/test_config.py
    goal: Admin configures Jellyseerr quality profile IDs without exposing them to users.
    id: '2.3'
    name: Admin Config for Quality Profiles
    notes: 'Profile IDs are int | None = None. None means use Jellyseerr default profile.
      Bot works out of the box without requiring admin to look up IDs.'
    scope: "- Add jellyseerr_4k_profile_id: int | None = None to AppConfig\n- Add\
      \ jellyseerr_1080p_profile_id: int | None = None to AppConfig\n- Pydantic field_validator:\
      \ must be positive int if set\n- Add to .env.example with comments explaining\
      \ how to find profile IDs\n"
    status: done
    test: '- test_config.py — Config loads with profile IDs set

      - Config loads with profile IDs unset (None)

      - Negative profile ID raises ValidationError

      '
  - files:
    - src/home_agent/tools/__init__.py
    - src/home_agent/tools/profile_tools.py
    - tests/test_profile_tools.py
    goal: Agent can update user preferences via tool calls during conversation.
    id: '2.4'
    name: Profile Tools
    notes: 'Tools are registered on the agent in agent.py. Each tool updates the profile
      via ProfileManager and returns a confirmation string.'
    scope: "- set_movie_quality(quality: Literal[\"4k\", \"1080p\"]) — stores preferred\
      \ movie quality\n- set_series_quality(quality: Literal[\"4k\", \"1080p\"]) —\
      \ stores preferred series quality\n- set_reply_language(language: str) — updates\
      \ reply language (natural language names)\n- set_confirmation_mode(mode: Literal[\"\
      always\", \"never\"]) — toggles confirmation\n- All tools use RunContext[AgentDeps]\
      \ and return str\n- Import-linter: tools does not import agent, bot, or main\n"
    status: done
    test: '- test_profile_tools.py — set_movie_quality updates profile and returns
      confirmation

      - set_reply_language("Dutch") updates profile.reply_language to "Dutch"

      - set_confirmation_mode("never") updates profile.confirmation_mode

      - All tools persist changes via ProfileManager

      '
  - files:
    - src/home_agent/agent.py
    - tests/test_agent.py
    goal: Agent confirms before requesting, asks quality lazily, and replies in user's
      language.
    id: '2.5'
    name: System Prompt & Confirmation Flow
    notes: 'Confirmation, quality onboarding, and language are all system prompt behaviors.
      No new code beyond prompt text and dynamic injection.'
    scope: "- Static system prompt: confirmation policy (check confirmation_mode),\
      \ search-then-confirm flow\n- Dynamic system prompt: inject movie_quality, series_quality\
      \ (or \"NOT SET — ask\"), reply_language\n- Quality onboarding: if movie_quality\
      \ is None and user requests a movie, ask \"4K or 1080p?\" first\n- Confirmation:\
      \ show title + year + quality, wait for user OK before calling request_media\n\
      - Language: \"Always reply in {profile.reply_language}\"\n"
    status: pending
    test: '- test_agent.py — Dynamic prompt includes "NOT SET" when quality is None

      - Dynamic prompt includes "Always reply in Dutch" when language is Dutch

      - Dynamic prompt includes confirmation policy based on confirmation_mode

      - Agent with TestModel calls set_movie_quality tool when quality not set (custom_output_text)

      '
  - files:
    - src/home_agent/agent.py
    - tests/test_agent.py
    goal: When a search returns multiple versions of the same title (e.g. director's
      cut, theatrical, remakes), the agent presents them as human-readable options
      and asks the user to pick one before requesting.
    id: '2.6'
    name: Search Disambiguation
    notes: 'The agent must never expose TMDB IDs, profile IDs, or other technical
      identifiers to the user. Questions should be natural: "I found two versions —
      Troy (2004) and Troy: Fall of a City (2018 TV series). Which one?" Disambiguation
      applies to both movies and series. If only one result matches clearly, skip
      straight to confirmation.'
    scope: "- System prompt addition: when search_media returns multiple results,\
      \ present a numbered list with title, year, and distinguishing details (director,\
      \ cast, format)\n- Ask the user to pick by number or description\n- Only call\
      \ request_media after the user selects a specific result AND confirms\n- Handle\
      \ edge cases: exact title match skips disambiguation, user says \"the first\
      \ one\", user changes mind\n- Works with the confirmation flow from step 2.5\
      \ — disambiguation happens BEFORE confirmation\n"
    status: pending
    test: '- test_agent.py — System prompt includes disambiguation instructions

      - test_agent.py — Agent with multiple search results asks user to choose (via
      TestModel custom_output_text)

      - test_agent.py — Agent with single clear result skips to confirmation

      '
  - files:
    - src/home_agent/agent.py
    - src/home_agent/bot.py
    - tests/test_agent.py
    - tests/test_integration.py
    goal: End-to-end verification that onboarding, confirmation, language switching,
      and disambiguation work together.
    id: '2.7'
    name: Wire & Verify UX Flow
    notes: ''
    scope: "- Register profile tools on agent in create_agent()\n- Verify full flow:\
      \ new user → auto-detect language → first movie request → quality onboarding\
      \ → confirmation → request\n- Verify language switch: user says \"speak Dutch\"\
      \ → agent calls set_reply_language → subsequent replies in Dutch\n- Verify skip-confirm:\
      \ user sets confirmation_mode to \"never\" → agent requests immediately\n"
    status: pending
    test: '- test_integration.py — New user first request triggers quality question
      before request_media

      - test_integration.py — User with movie_quality set gets confirmation prompt

      - test_integration.py — Language switch persists across messages

      '
- focus: Rich Telegram UX, proactive behavior, multi-user, and extended capabilities.
  id: 3
  name: Polish & Advanced Features
  steps:
  - files:
    - src/home_agent/tools/telegram_tools.py
    goal: Responses use inline keyboards, images, and formatted text.
    id: '3.1'
    name: Rich Telegram Formatting
    notes: ''
    scope: '- Agent tool to send inline keyboard buttons (e.g., confirm/deny)

      - Agent tool to send images (movie posters fetched from TMDB/Jellyseerr)

      - Markdown formatting for structured responses

      '
    status: pending
    test: '- test_telegram_tools.py — Inline keyboard tool produces correct Telegram
      markup

      - Image tool fetches and sends a photo message

      - Markdown output is valid Telegram MarkdownV2

      '
  - files:
    - src/home_agent/notifications.py
    goal: Bot notifies user when downloads complete or issues arise.
    id: '3.2'
    name: Proactive Notifications
    notes: ''
    scope: '- Periodic poller (or Jellyseerr webhook receiver) that checks for completed
      downloads

      - Pushes notification to user via Telegram

      - Respects quiet_hours from user profile

      '
    status: pending
    test: '- test_notifications.py — Completed download triggers a Telegram message

      - Notification suppressed during quiet hours

      - Duplicate notifications are not sent

      '
  - files:
    - src/home_agent/profile.py
    - src/home_agent/bot.py
    goal: Multiple users with separate profiles and permission levels.
    id: '3.3'
    name: Multi-User Support
    notes: ''
    scope: '- Per-user profile isolation

      - Permission levels (admin, user, read-only)

      - Admin can manage other users'' permissions via chat

      '
    status: pending
    test: '- test_multi_user.py — Two users have separate profiles and histories

      - Read-only user can search but not request

      - Admin can modify permissions

      '
  - files:
    - src/home_agent/bot.py
    goal: User sends voice message, agent processes it as text.
    id: '3.4'
    name: Voice Message Support
    notes: ''
    scope: '- Voice message handler that downloads audio

      - Transcription via Whisper (local or API)

      - Transcribed text fed to agent as normal message

      '
    status: pending
    test: '- test_voice.py — Voice message handler extracts audio file

      - Transcription produces text

      - Agent receives transcribed text and responds normally

      '
  - files: []
    goal: File conversion capabilities via natural language.
    id: '3.5'
    name: IT Tools / BentoPDF / Vert Integration
    notes: ''
    scope: '- Find existing MCP servers

      - Tools needed: convert_file(input_path, output_format), list_supported_formats()

      - Agent can receive a file via Telegram, convert it, and send back the result

      '
    status: pending
    test: '- test_conversion_mcp.py — Supported formats list is returned

      - Conversion request sends correct payload

      - Agent handles unsupported format gracefully with a helpful message

      '
- focus: Add system monitoring via Glances MCP server.
  id: 4
  name: Glances Integration
  steps:
  - files:
    - mcp_servers/glances/server.py
    goal: MCP server exposing Glances system metrics.
    id: '4.1'
    name: Find or Build Glances MCP Server
    notes: ''
    scope: "- Search GitHub / MCP registries for existing Glances MCP server\n- Evaluate\
      \ if it covers: CPU, memory, disk, network, per-container stats\n- If none found,\
      \ build with FastMCP wrapping Glances REST API\n- Core tools: get_system_overview(),\
      \ get_cpu(), get_memory(), get_disk(),\n  get_network(), get_containers()\n"
    status: pending
    test: '- test_glances_mcp.py — MCP server starts and lists expected tools

      - get_system_overview returns structured CPU/mem/disk data against a mock Glances
      API

      - Handles Glances API being unreachable gracefully

      '
  - files:
    - src/home_agent/mcp/servers.py
    goal: Glances MCP server loads alongside Jellyseerr on agent startup.
    id: '4.2'
    name: Register Glances in MCP Registry
    notes: ''
    scope: '- Add Glances server config

      - GLANCES_URL added to AppConfig

      - Registry starts both servers

      '
    status: pending
    test: '- test_mcp_registry.py (update) — Registry with two servers starts both

      - Agent tool list includes both Jellyseerr and Glances tools

      '
  - files:
    - src/home_agent/agent.py
    goal: Agent knows how to use system monitoring and formats stats readably.
    id: '4.3'
    name: System Prompt Update
    notes: ''
    scope: "- System prompt extended with monitoring capabilities and formatting guidance\n\
      \  (e.g., use emoji for status indicators, warn if disk > 80%)\n"
    status: pending
    test: "- test_agent.py (update) — Agent presented with \"how's my server?\" generates\
      \ a\n  response that includes CPU/memory stats (mocked MCP)\n- Agent flags high\
      \ disk usage when disk > 80%\n"
- focus: 'Add MCP servers one at a time. Each follows the same pattern: find existing
    → evaluate → connect → test.'
  id: 5
  name: Expand Services
  steps:
  - files: []
    goal: Photo management via natural language.
    id: '5.1'
    name: Immich MCP Server
    notes: ''
    scope: '- Find existing MCP server

      - Tools needed: search_photos(query, date_range), get_album_list(), get_storage_stats()

      - System prompt update for photo-related queries

      '
    status: pending
    test: '- test_immich_mcp.py — Tools return structured data from mock API

      - Search with date range filters correctly

      - Agent responds to "show me photos from last weekend" with photo results

      '
  - files: []
    goal: Recipe and meal plan management via natural language.
    id: '5.2'
    name: Mealie MCP Server
    notes: ''
    scope: "- Find existing MCP server\n- Tools needed: search_recipes(query), get_meal_plan(date),\n\
      \  add_to_meal_plan(recipe_id, date), get_shopping_list()\n- System prompt update\n"
    status: pending
    test: '- test_mealie_mcp.py — Recipe search returns results

      - Meal plan queries return structured daily plan

      - Adding to meal plan sends correct request

      '
  - files: []
    goal: Baby tracking via natural language.
    id: '5.3'
    name: BabyBuddy MCP Server
    notes: ''
    scope: "- Find existing MCP server\n- Tools needed: log_feeding(type, amount,\
      \ time), log_diaper(type, time),\n  log_sleep(start, end), get_last_event(type),\
      \ get_daily_summary()\n- System prompt update\n"
    status: pending
    test: '- test_babybuddy_mcp.py — Logging events sends correct data

      - get_last_event("diaper") returns most recent entry

      - Daily summary aggregates correctly

      '
  - files: []
    goal: Document search and management via natural language.
    id: '5.4'
    name: Paperless-ngx MCP Server
    notes: ''
    scope: "- Find existing MCP server\n- Tools needed: search_documents(query), get_document(id),\n\
      \  add_tag(doc_id, tag), get_tags()\n- System prompt update\n"
    status: pending
    test: '- test_paperless_mcp.py — Document search returns results with title, date,
      tags

      - Tag operations modify document metadata correctly

      '
  - files: []
    goal: Task management via natural language.
    id: '5.5'
    name: Vikunja MCP Server
    notes: ''
    scope: "- Find existing MCP server\n- Tools needed: get_tasks(list, filter), create_task(title,\
      \ list, due_date),\n  complete_task(id), get_lists()\n- System prompt update\n"
    status: pending
    test: '- test_vikunja_mcp.py — Task creation returns task with ID

      - Listing tasks returns structured list

      - Completing a task updates its status

      '
  - files: []
    goal: Service uptime monitoring via natural language.
    id: '5.6'
    name: Uptime Kuma MCP Server
    notes: ''
    scope: '- Find existing MCP server

      - Tools needed: get_monitors(), get_monitor_status(id), get_heartbeat(id)

      - System prompt update

      '
    status: pending
    test: '- test_uptimekuma_mcp.py — Monitor list returns all configured monitors
      with status

      - Heartbeat returns uptime percentage

      - Agent responds to "is everything online?" with a summary

      '
  - files: []
    goal: Docker container management via natural language.
    id: '5.7'
    name: Portainer MCP Server
    notes: ''
    scope: "- Find existing MCP server\n- Tools needed: list_containers(), get_container(name),\n\
      \  restart_container(name), get_container_logs(name, lines)\n- System prompt\
      \ update\n- Confirmation required for restart/stop actions\n"
    status: pending
    test: '- test_portainer_mcp.py — Container listing returns names and statuses

      - Restart sends correct API call

      - Agent asks for confirmation before restarting

      '
  - files: []
    goal: Backup status monitoring via natural language.
    id: '5.8'
    name: Duplicati MCP Server
    notes: ''
    scope: '- Find existing MCP server

      - Tools needed: list_backups(), get_backup_status(id), get_last_run(id)

      - System prompt update

      '
    status: pending
    test: '- test_duplicati_mcp.py — Backup listing returns backup jobs with last
      run time

      - Status shows healthy/warning/error state

      '
  - files:
    - src/home_agent/mcp/registry.py
    goal: Only load relevant MCP servers per conversation to reduce token cost.
    id: '5.9'
    name: Tool Filtering & Context-Aware Loading
    notes: ''
    scope: '- Classify incoming message to determine which MCP servers are relevant

      - Lazy-connect only those servers for the agent call

      - Disconnect idle servers after timeout

      '
    status: pending
    test: '- test_tool_filtering.py — Message "search for a movie" only loads Jellyseerr
      tools

      - Message "how''s my server" only loads Glances tools

      - Message "is everything online" only loads Uptime Kuma tools

      - Ambiguous message loads all tools

      '
project: home-agent
